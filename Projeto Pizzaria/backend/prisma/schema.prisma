generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Funcionario {
  id         String    @id @default(uuid())
  name       String
  funcao     String
  email      String
  password   String
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())

  @@map("funcionarios")
}

model Cliente {
  id         String    @id @default(uuid())
  name       String
  email      String
  password   String
  cpf        String
  data_nasc  DateTime?
  image_url  String?
  points     Float     @default(0)
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())

  avaliacao Avaliacao[]
  favoritos Favorito[]
  comandas  Comanda[]
  pedidos   Pedido[]

  @@map("clientes")
}

model Favorito {
  id         String    @id @default(uuid())
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())

  product    Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  product_id String

  cliente    Cliente @relation(fields: [cliente_id], references: [id], onDelete: Cascade)
  cliente_id String

  @@map("favorites")
}

model Category {
  id         String    @id @default(uuid())
  name       String
  image_url  String?
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())

  products Product[]

  @@map("categories")
}

model Product {
  id          String    @id @default(uuid())
  name        String
  price       Float
  points      Float
  description String
  promocao    Boolean
  image_url   String?
  created_at  DateTime? @default(now())
  updated_at  DateTime? @default(now())

  category            Category              @relation(fields: [category_id], references: [id])
  category_id         String
  sabor1_items        Item[]                @relation("Sabor1")
  sabor2_items        Item[]                @relation("Sabor2")
  favoritos           Favorito[]
  product_ingrediente Product_ingrediente[]

  @@map("products")
}

model Pedido {
  id         String    @id @default(uuid())
  status     String
  price      Float
  points     Float
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())

  cliente    Cliente @relation(fields: [cliente_id], references: [id], onDelete: Cascade)
  cliente_id String
  comanda    Comanda @relation(fields: [comanda_id], references: [id], onDelete: Cascade)
  comanda_id String

  items Item[]

  @@map("pedidos")
}

model Comanda {
  id           String    @id @default(uuid())
  status       String
  price        Float
  points       Float
  tipoPagamento String?  
  pagoEm       DateTime? 
  created_at   DateTime? @default(now())
  updated_at   DateTime? @default(now())

  cliente    Cliente @relation(fields: [cliente_id], references: [id], onDelete: Cascade)
  cliente_id String

  mesa    Mesa?   @relation(fields: [mesa_id], references: [id], onDelete: Cascade)
  mesa_id String?

  avaliacao Avaliacao[]
  pedido    Pedido[]

  @@map("comandas")
}

model Avaliacao {
  id         String    @id @default(uuid())
  nota       Int
  descricao  String
  created_at DateTime? @default(now())

  cliente    Cliente @relation(fields: [cliente_id], references: [id], onDelete: Cascade)
  comanda    Comanda @relation(fields: [comanda_id], references: [id], onDelete: Cascade)
  cliente_id String
  comanda_id String

  @@map("avaliacoes")
}

model Item {
  id           String    @id @default(uuid())
  qtd          Int
  price        Float
  points       Float     @default(0)
  removidos    Json?
  adicionais   Json?
  observacoes  String?
  dois_sabores Boolean   @default(false)
  created_at   DateTime? @default(now())
  updated_at   DateTime? @default(now())

  pedido   Pedido   @relation(fields: [pedido_id], references: [id], onDelete: Cascade)
  product  Product  @relation("Sabor1", fields: [product_id], references: [id], onDelete: Cascade)
  product2 Product? @relation("Sabor2", fields: [product2_id], references: [id], onDelete: SetNull)

  pedido_id      String
  product_id     String
  product2_id    String?
  Item_adicional Item_adicional[]

  @@map("items")
}

model Ingrediente {
  id         String    @id @default(uuid())
  nome       String
  price      Float
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())

  Product_ingrediente Product_ingrediente[]

  @@map("ingredientes")
}

model Product_ingrediente {
  id         String    @id @default(uuid())
  qtd        Boolean   @default(true)
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())

  product    Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  product_id String

  ingrediente    Ingrediente @relation(fields: [ingrediente_id], references: [id], onDelete: Cascade)
  ingrediente_id String

  @@map("product_ingrediente")
}

model Adicional {
  id         String    @id @default(uuid())
  nome       String
  price      Float
  points     Float     @default(0)
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())

  Item_adicional Item_adicional[]

  @@map("adicionais")
}

model Item_adicional {
  id  String @id @default(uuid())
  qtd Int    @default(1)

  item    Item   @relation(fields: [item_id], references: [id], onDelete: Cascade)
  item_id String

  adicional    Adicional @relation(fields: [adicional_id], references: [id], onDelete: Cascade)
  adicional_id String

  @@map("item_adicional")
}

model Mesa {
  id          String @id @default(uuid())
  numero_mesa Int    @unique
  url         String @default("")

  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())

  Comanda Comanda[]

  @@map("mesas")
}
